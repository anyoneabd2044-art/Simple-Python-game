import random

choices = {
    "r": "rock",
    "p": "paper",
    "s": "scissors"
}

win_map = {
    "rock": "scissors",
    "paper": "rock",
    "scissors": "paper"
}

def smart_ai(user_history):
    if not user_history:
        return random.choice(list(choices.values()))

    # Find most common user move
    most_common = max(set(user_history), key=user_history.count)

    # AI plays move that beats user's most common move
    for move, beats in win_map.items():
        if beats == most_common:
            return move

def play_game():
    user_score = 0
    comp_score = 0
    user_history = []
    rounds_to_win = 3  # Best of 5

    print("\nğŸ”¥ Rock Paper Scissors - Best of 5")
    print("Keys: r = rock, p = paper, s = scissors, q = quit\n")

    while user_score < rounds_to_win and comp_score < rounds_to_win:
        user = input("Enter choice: ").lower()

        if user == "q":
            print("Game exited ğŸ‘‹")
            return

        if user not in choices:
            print("Invalid input! Use r, p, or s.")
            continue

        user_choice = choices[user]
        user_history.append(user_choice)

        computer = smart_ai(user_history[:-1])

        print("You chose:", user_choice)
        print("Computer chose:", computer)

        if user_choice == computer:
            print("It's a Draw!")
        elif win_map[user_choice] == computer:
            print("ğŸ‰ You Win this round!")
            user_score += 1
        else:
            print("ğŸ¤– Computer Wins this round!")
            comp_score += 1

        print(f"Score -> You: {user_score} | Computer: {comp_score}")
        print("-" * 40)

    if user_score > comp_score:
        print("ğŸ† You Won the Match!")
    else:
        print("ğŸ’€ Computer Won the Match!")

while True:
    play_game()
    again = input("\nPlay again? (y/n): ").lower()
    if again != "y":
        print("Thanks for playing! ğŸš€")
        break
